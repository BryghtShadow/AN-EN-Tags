<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
		<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed|Roboto&display=swap" rel="stylesheet">
		<style type="text/css">
			body {
				font-family: "Roboto Condensed", sans-serif;
			}
			dt {font-weight: 700;}

		</style>
	</head>
	<body>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.min.js"></script> -->
		<script src="js/vue.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
		<script type="text/javascript">
			Vue.filter('zerofill', function (value) {
			  //value = ( value < 0 ? 0 : value );
			  return (value < 10 && value > -1 ? '0' : '') + value;
			});

			var el = document.createElement('div')
			document.body.appendChild(el);

			var icon = `<svg x="0" y="0" viewBox="0 0 10 10" height="1em"><g fill="none" stroke="#000" stroke-width="10%" stroke-linecap="square">
			<circle cx="50%" cy="50%" r="45%"/>
			<line x1="50%" y1="50%" x2="30%" y2="50%"/>
			<line x1="50%" y1="50%" x2="50%" y2="30%"/>
			</g></svg>`;

			new Vue({
				el: el,
				template: `<div class="clock">
				<dl>
				<dt>Now:</dt><dd>{{ now }}</dd>
				<dt>Midnight:</dt><dd>{{ midnight }}</dd>
				<dt>Daily:</dt><dd>${icon} <span>{{ time.Hours | zerofill }}</span>:<span>{{ time.Minutes | zerofill }}</span>:<span>{{ time.Seconds | zerofill }}</span></dd>
				</dl>
				</div>`,

				data() {
					return {
						midnight: moment().utcOffset(-11).startOf('day'),
						i: 0,
						time: {
							Hours: 0,
							Minutes: 0,
							Seconds: 0,
						},
						now: 0,
						offset: -11 * 60,
					};
				},

				methods: {
					setCountdown(d) {
						if (d) {
							this.countdown = moment(d, 'YYYY-MM-DD HH:mm:ss').utcOffset(this.offset);
						} else {
							this.countdown = moment().utcOffset(this.offset).endOf('day');
						}
					},

					tick() {
						this.frame = requestAnimationFrame(this.tick.bind(this));
						if (this.i++ % 10) { return; } // throttle
						var now = moment(new Date()).utcOffset(this.offset);
						if (this.countdown) {
							var t = this.countdown.diff(now);
							if (t <= 0) {
								this.setCountdown(0)
								this.midnight = this.countdown;
								t = this.countdown.diff(now);
							}
							this.time.Hours = Math.floor((t / 36e5) % 24);
							this.time.Minutes = Math.floor((t / 6e4) % 60);
							this.time.Seconds = Math.floor((t / 1e3) % 60);
						} else {
							this.time.Hours = t.hours() % 25;
							this.time.Minutes = t.minutes();
							this.time.Seconds = t.seconds();
						}
						this.time.Total = t;
						this.now = now;
						return this.time;
					}
				},

				mounted() {
					this.$nextTick(function() {
						if (window.requestAnimationFrame) {
							this.setCountdown(this.midnight);
							this.callback = this.callback || function(){};
							this.tick();
						}
					})
				},

			});
		</script>
	</body>

</html>