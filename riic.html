<style>
	.operator {
		border: thin solid red;
		margin-bottom: .5em;
	}
</style>
<script src='js/jquery-3.4.0.min.js'></script>
<body>

<script>
let languageRegionMap = {
	'en': 'en_US',
	'ja': 'ja_JP',
	'ko': 'ko_KR',
	'cn': 'zh_CN',
	'tw': 'zh_TW',
}
let db = {
	manufactformulas: {},
	workshopformulas: {},
	building_buffs: {},
	building_chars: {},
	chars: {},
}
function f(dst, code, src) {
	Object.entries(src).reduce((acc, [k, v]) => {
		acc[k] = acc[k] || {}
		acc[k][code] = v
		return acc
	}, dst)
}
let promises = Object.values(languageRegionMap)
.reduce((acc, code) => {
	acc.push(
		fetch(`json/gamedata/${code}/gamedata/excel/building_data.json`)
		.then((r) => r.json())
		.then((data) => {
			f(db.manufactformulas, code, data.manufactFormulas)
			f(db.workshopformulas, code, data.workshopFormulas)
			f(db.building_buffs, code, data.buffs)
			f(db.building_chars, code, data.chars)
		})
	)
	acc.push(
		fetch(`json/gamedata/${code}/gamedata/excel/character_table.json`)
		.then((r) => r.json())
		.then((data) => {
			f(db.chars, code, data)
		})
	)
	return acc
}, [])

Promise.all(promises).then(data=>{
	console.log(db)

	let reg = 'en_US'
	let lang = 'en_US'

	let roomType = 'TRADING'
	let $html = Object.entries(db.building_chars).map(([k,v])=>{
		let found = v[reg] && v[reg].buffChar.some(buffChar=>{
			return buffChar.buffData.some(buffData=>{
				return db.building_buffs[buffData.buffId][reg].roomType == roomType
			})
		})
		return `<div class="operator">
		${db.chars[k][reg].name}<br>${JSON.stringify(db.building_buffs[v[reg].buffChar[0].buffData[0].buffId][reg])}
		</div>`
	}).join('\n')

	$('body').html($html)
})
</script>
</body>